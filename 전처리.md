
<font size="10"> 전처리 </font>

-------------------------------
<br />

모든 팀원이 쉽게 이해할 수 있는 코드를 작성하여 효율적인 프로젝트 진행을 목표로 합니다.
<br />
<br />
**변수 생성 기준**

- 예측 정확도 상승
- 편의

**변수 네이밍 규칙**

- 고유명사가 아닌 줄임말은 명확하도록 풀어 적는다. e.g.) STT -> sched_time
- 줄임말 기준: 
    - 줄임말을 썻을 때 이해하기 쉬운 경우
    - 기존 이름이 너무 장황
    - 일반적으로 많이 쓰는 줄임말을 사용. 
    - e.g.) count -> cnt, average -> avg, schedule -> sched 
- 동사를 앞에 적는다. 동사\_명사 e.g.) sum_flight, avg_flight, cnt_flight
- 자주 사용되는 단어일수록 앞에 위치 e.g.) sched_time, sched_datetime
- 더미변수(binary 변수)는 is_이름 e.g.) is_delay, is_holiday
- 생소하거나 어려운 단어라면 길더라도 그냥 쓰자.
- "."을 사용하지말고 "\_"로 통일하자. "."을 사용하게 되면 메소드와 혼돈을 일으킴.
- GPA와 같은 이름을 제외하면 소문자를 사용하자.
- 영어 이름을 사용하자.

**가독성**

- 주석을 달아주자.
- 코딩실력이 된다면 혹은 코딩실력 상승을 위해서
    - 코드 실행 단축을 위한 벡터화: 간단히 설명하자면 for루프, apply 대신 판다스, 사이킨런 내장함수를 사용하면 된다.
    - 반복된 코드로 스크립트가 길어지는 것을 방지하기 위해 함수화하자. 
    - 메모리를 위해 가끔식 객체 삭제가 필요할 수도 있다.
- 파이썬 스타일 가이드 PEP8을 지키자. 적어도 망치를 눌러주자.

<br />

<font size="4"> 모든 데이터셋에 대해서 다음과 같은 변수를 추가했습니다. </font>

- 날짜(date): yyyy-mm-dd
- 날짜시간(datetime): yyyy-mm-dd hh:mm:ss

EDA를 기준으로 작성하였으며 모델링용 데이터셋은 나중에 다시 작성하겠습니다.

# AFSNT.csv


```python
import pandas as pd

df_afsnt = pd.read_csv("AFSNT.csv", encoding="CP949")
df_afsnt["STT"] = pd.to_datetime(df_afsnt["STT"], format = "%H:%M").dt.time
df_afsnt["ATT"] = pd.to_datetime(df_afsnt["ATT"], format = "%H:%M").dt.time

df_afsnt = df_afsnt.rename(columns={ 
    "SDT_YY": "year", "SDT_MM":"month", "SDT_DD":"day",  "SDT_DY":"wday", 
    "ARP":"origin", "ODP":"dest", 
    "FLO":"airline", "FLT":"flight" ,"REG":"tailnum", 
    "AOD":"is_arrive", 
    "IRR":"is_regular", 
    "STT":"sched_time", "ATT":"real_time", 
    "DLY":"is_delay", "DRR":"cause_delay", 
    "CNL":"is_cancel", "CNR":"cause_cancel"
})
df_afsnt["date"] = pd.to_datetime(df_afsnt[["year", "month", "day"]])
df_afsnt["sched_datetime"] = pd.to_datetime(df_afsnt['date'].astype(str) + " " + df_afsnt["sched_time"].astype(str))
df_afsnt["real_datetime"] = pd.to_datetime(df_afsnt['date'].astype(str) + " " + df_afsnt["real_time"].astype(str))

# delay 변수 생성
temp = df_afsnt["real_datetime"] - df_afsnt["sched_datetime"] 
temp = pd.DataFrame(temp.dt.components)
df_afsnt["delay"] = temp['minutes'] + 60 * temp['hours'] + 1440 * temp['days']
del temp

df_afsnt.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>month</th>
      <th>day</th>
      <th>wday</th>
      <th>origin</th>
      <th>dest</th>
      <th>airline</th>
      <th>flight</th>
      <th>tailnum</th>
      <th>is_arrive</th>
      <th>...</th>
      <th>sched_time</th>
      <th>real_time</th>
      <th>is_delay</th>
      <th>cause_delay</th>
      <th>is_cancel</th>
      <th>cause_cancel</th>
      <th>date</th>
      <th>sched_datetime</th>
      <th>real_datetime</th>
      <th>delay</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2017</td>
      <td>1</td>
      <td>1</td>
      <td>일</td>
      <td>ARP3</td>
      <td>ARP6</td>
      <td>J</td>
      <td>J1955</td>
      <td>SEw3NzE4</td>
      <td>D</td>
      <td>...</td>
      <td>10:05:00</td>
      <td>10:32:00</td>
      <td>N</td>
      <td>NaN</td>
      <td>N</td>
      <td>NaN</td>
      <td>2017-01-01</td>
      <td>2017-01-01 10:05:00</td>
      <td>2017-01-01 10:32:00</td>
      <td>27</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2017</td>
      <td>1</td>
      <td>1</td>
      <td>일</td>
      <td>ARP3</td>
      <td>ARP6</td>
      <td>J</td>
      <td>J1954</td>
      <td>SEw3NzE4</td>
      <td>A</td>
      <td>...</td>
      <td>09:30:00</td>
      <td>09:31:00</td>
      <td>N</td>
      <td>NaN</td>
      <td>N</td>
      <td>NaN</td>
      <td>2017-01-01</td>
      <td>2017-01-01 09:30:00</td>
      <td>2017-01-01 09:31:00</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2017</td>
      <td>1</td>
      <td>1</td>
      <td>일</td>
      <td>ARP3</td>
      <td>ARP6</td>
      <td>J</td>
      <td>J1956</td>
      <td>SEw3NzE4</td>
      <td>A</td>
      <td>...</td>
      <td>12:45:00</td>
      <td>13:03:00</td>
      <td>N</td>
      <td>NaN</td>
      <td>N</td>
      <td>NaN</td>
      <td>2017-01-01</td>
      <td>2017-01-01 12:45:00</td>
      <td>2017-01-01 13:03:00</td>
      <td>18</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2017</td>
      <td>1</td>
      <td>1</td>
      <td>일</td>
      <td>ARP3</td>
      <td>ARP6</td>
      <td>J</td>
      <td>J1957</td>
      <td>SEw3NzE4</td>
      <td>D</td>
      <td>...</td>
      <td>13:25:00</td>
      <td>14:09:00</td>
      <td>Y</td>
      <td>C02</td>
      <td>N</td>
      <td>NaN</td>
      <td>2017-01-01</td>
      <td>2017-01-01 13:25:00</td>
      <td>2017-01-01 14:09:00</td>
      <td>44</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2017</td>
      <td>1</td>
      <td>1</td>
      <td>일</td>
      <td>ARP3</td>
      <td>ARP6</td>
      <td>J</td>
      <td>J1958</td>
      <td>SEw3NzE4</td>
      <td>A</td>
      <td>...</td>
      <td>16:10:00</td>
      <td>16:31:00</td>
      <td>N</td>
      <td>NaN</td>
      <td>N</td>
      <td>NaN</td>
      <td>2017-01-01</td>
      <td>2017-01-01 16:10:00</td>
      <td>2017-01-01 16:31:00</td>
      <td>21</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 21 columns</p>
</div>



# AFSNT_DLY.csv


```python
df_test = pd.read_csv("AFSNT_DLY.csv", encoding="CP949")
df_test["STT"] = pd.to_datetime(df_test["STT"], format = "%H:%M").dt.time

df_test = df_test.rename(columns={ 
    "SDT_YY": "year", "SDT_MM":"month", "SDT_DD":"day",  "SDT_DY":"wday", 
    "ARP":"origin", "ODP":"dest", 
    "FLO":"airline", "FLT":"flight" ,"REG":"tailnum", 
    "AOD":"is_arrive", 
    "IRR":"is_regular", 
    "STT":"sched_time", 
    "DLY":"is_delay", "DLY_RATE":"prob_delay"
})
df_test["date"] = pd.to_datetime(df_test[["year", "month", "day"]])
df_test["sched_datetime"] = pd.to_datetime(df_test['date'].astype(str) + " " + df_test["sched_time"].astype(str))

df_test.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>month</th>
      <th>day</th>
      <th>wday</th>
      <th>origin</th>
      <th>dest</th>
      <th>airline</th>
      <th>flight</th>
      <th>is_arrive</th>
      <th>sched_time</th>
      <th>is_delay</th>
      <th>prob_delay</th>
      <th>date</th>
      <th>sched_datetime</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019</td>
      <td>9</td>
      <td>16</td>
      <td>월</td>
      <td>ARP1</td>
      <td>ARP3</td>
      <td>L</td>
      <td>L1702</td>
      <td>A</td>
      <td>09:05:00</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2019-09-16</td>
      <td>2019-09-16 09:05:00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019</td>
      <td>9</td>
      <td>16</td>
      <td>월</td>
      <td>ARP3</td>
      <td>ARP1</td>
      <td>L</td>
      <td>L1702</td>
      <td>D</td>
      <td>07:55:00</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2019-09-16</td>
      <td>2019-09-16 07:55:00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019</td>
      <td>9</td>
      <td>16</td>
      <td>월</td>
      <td>`</td>
      <td>ARP3</td>
      <td>L</td>
      <td>L1720</td>
      <td>A</td>
      <td>14:40:00</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2019-09-16</td>
      <td>2019-09-16 14:40:00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019</td>
      <td>9</td>
      <td>16</td>
      <td>월</td>
      <td>ARP3</td>
      <td>ARP1</td>
      <td>L</td>
      <td>L1720</td>
      <td>D</td>
      <td>13:30:00</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2019-09-16</td>
      <td>2019-09-16 13:30:00</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019</td>
      <td>9</td>
      <td>16</td>
      <td>월</td>
      <td>ARP4</td>
      <td>ARP3</td>
      <td>L</td>
      <td>L1808</td>
      <td>A</td>
      <td>20:10:00</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2019-09-16</td>
      <td>2019-09-16 20:10:00</td>
    </tr>
  </tbody>
</table>
</div>



# SFSNT.csv


```python
df_sched = pd.read_csv("SFSNT.csv", dtype={"FSD":str, "FED":str}, encoding="CP949")
df_sched = df_sched.drop("SSC", 1)
# print(df_sched.apply(lambda x: np.sum(pd.isnull(x)))) # 결측치 존재 
df_sched.loc[:, ["STA", "STD"]] = df_sched[["STA", "STD"]].fillna("00:00")
df_sched["STA"] = pd.to_datetime(df_sched["STA"], format = "%H:%M").dt.time
df_sched["STD"] = pd.to_datetime(df_sched["STD"], format = "%H:%M").dt.time

df_sched = df_sched.rename(columns={ 
    "ORG":"origin", "DES":"dest", 
    "FLO":"airline", "FLT":"flight",  
    "STD":"dep_time", "STA":"arr_time",  # dep: depart, arr: arrive 
    "FSD":"start_date", "FED":"end_date", 
    "IRR":"is_regular" 
})



df_sched["start_date"] = df_sched['start_date'].str[:4] + "-" + df_sched['start_date'].str[4:6] + "-" + df_sched['start_date'].str[6:]
df_sched["end_date"] = df_sched['end_date'].str[:4] + "-" + df_sched['end_date'].str[4:6] + "-" + df_sched['end_date'].str[6:]
df_sched["start_dep_datetime"] = pd.to_datetime(df_sched["start_date"].astype(str) + " " + df_sched["dep_time"].astype(str))
df_sched["start_arr_datetime"] = pd.to_datetime(df_sched["start_date"].astype(str) + " " + df_sched["arr_time"].astype(str))
df_sched["end_dep_datetime"] = pd.to_datetime(df_sched["end_date"].astype(str) + " " + df_sched["dep_time"].astype(str))
df_sched["end_arr_datetime"] = pd.to_datetime(df_sched["end_date"].astype(str) + " " + df_sched["arr_time"].astype(str))

df_sched.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>flight</th>
      <th>origin</th>
      <th>dest</th>
      <th>dep_time</th>
      <th>arr_time</th>
      <th>airline</th>
      <th>MON</th>
      <th>TUE</th>
      <th>WED</th>
      <th>THU</th>
      <th>FRI</th>
      <th>SAT</th>
      <th>SUN</th>
      <th>start_date</th>
      <th>end_date</th>
      <th>is_regular</th>
      <th>start_dep_datetime</th>
      <th>start_arr_datetime</th>
      <th>end_dep_datetime</th>
      <th>end_arr_datetime</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A1915</td>
      <td>ARP1</td>
      <td>ARP3</td>
      <td>07:55:00</td>
      <td>09:05:00</td>
      <td>A</td>
      <td>Y</td>
      <td>Y</td>
      <td>Y</td>
      <td>Y</td>
      <td>Y</td>
      <td>Y</td>
      <td>Y</td>
      <td>2019-03-31</td>
      <td>2019-10-26</td>
      <td>N</td>
      <td>2019-03-31 07:55:00</td>
      <td>2019-03-31 09:05:00</td>
      <td>2019-10-26 07:55:00</td>
      <td>2019-10-26 09:05:00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A1904</td>
      <td>ARP3</td>
      <td>ARP1</td>
      <td>07:55:00</td>
      <td>09:05:00</td>
      <td>A</td>
      <td>Y</td>
      <td>Y</td>
      <td>Y</td>
      <td>Y</td>
      <td>Y</td>
      <td>Y</td>
      <td>Y</td>
      <td>2019-03-31</td>
      <td>2019-10-26</td>
      <td>N</td>
      <td>2019-03-31 07:55:00</td>
      <td>2019-03-31 09:05:00</td>
      <td>2019-10-26 07:55:00</td>
      <td>2019-10-26 09:05:00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>I1304</td>
      <td>ARP3</td>
      <td>ARP1</td>
      <td>08:00:00</td>
      <td>09:15:00</td>
      <td>I</td>
      <td>Y</td>
      <td>NaN</td>
      <td>Y</td>
      <td>Y</td>
      <td>Y</td>
      <td>NaN</td>
      <td>Y</td>
      <td>2019-03-31</td>
      <td>2019-10-26</td>
      <td>N</td>
      <td>2019-03-31 08:00:00</td>
      <td>2019-03-31 09:15:00</td>
      <td>2019-10-26 08:00:00</td>
      <td>2019-10-26 09:15:00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>B1802</td>
      <td>ARP2</td>
      <td>ARP1</td>
      <td>08:00:00</td>
      <td>08:55:00</td>
      <td>B</td>
      <td>Y</td>
      <td>Y</td>
      <td>Y</td>
      <td>Y</td>
      <td>Y</td>
      <td>Y</td>
      <td>Y</td>
      <td>2019-03-31</td>
      <td>2019-10-26</td>
      <td>N</td>
      <td>2019-03-31 08:00:00</td>
      <td>2019-03-31 08:55:00</td>
      <td>2019-10-26 08:00:00</td>
      <td>2019-10-26 08:55:00</td>
    </tr>
    <tr>
      <th>4</th>
      <td>J1106</td>
      <td>ARP1</td>
      <td>ARP2</td>
      <td>08:00:00</td>
      <td>09:05:00</td>
      <td>J</td>
      <td>NaN</td>
      <td>Y</td>
      <td>Y</td>
      <td>NaN</td>
      <td>Y</td>
      <td>Y</td>
      <td>NaN</td>
      <td>2019-07-30</td>
      <td>2019-08-24</td>
      <td>N</td>
      <td>2019-07-30 08:00:00</td>
      <td>2019-07-30 09:05:00</td>
      <td>2019-08-24 08:00:00</td>
      <td>2019-08-24 09:05:00</td>
    </tr>
  </tbody>
</table>
</div>



일단 요일은 건드리지 않았습니다.
